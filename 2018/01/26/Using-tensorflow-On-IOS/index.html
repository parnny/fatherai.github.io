<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Using TensorFlow On IOS | Father AI Blog</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="Yi Gu"><meta name="designer" content="minfive"><meta name="keywords" content="AI, deeplearning, RL, dnn"><meta name="description" content="Dedicated to sharing the latest achievements and experience in artificial intelligence"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://github.com/fatherai/2018/01/26/Using-tensorflow-On-IOS/index.html"><link rel="icon" type="image/png" href="http://oo12ugek5.bkt.clouddn.com/blog/images/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Father AI"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(http://oo12ugek5.bkt.clouddn.com/blog/images/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Father AI" alt="Father AI"><img src="/img/kingsoft_logo.png" alt="Father AI"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="Home" title="Home">Home</a></li><li class="nav__item"><a href="/archives" alt="Archive" title="Archive">Archive</a></li><li class="nav__item"><a href="/about" alt="About" title="About">About</a></li><li class="nav__item"><a href="https://github.com/fatherai" alt="Github" title="Github"><i class="iconfont icon-github" style="font-size:32px"></i></a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="https://www.seoclerk.com/pics/550925-1fY25w1502215384.jpg" alt="Using TensorFlow On IOS"></div><header class="post__info"><h1 class="post__title">Using TensorFlow On IOS</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://github.com/C-ID">Tongyao Bai</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-01-26</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/tensorflow/">Tensorflow</a></li><li class="mark__item"><a href="/tags/machine-learning/">Machine Learning</a></li><li class="mark__item"><a href="/tags/ios/">Ios</a></li></ul></div></div></header><div class="post__content"><h2 id="Using-TensorFlow-On-IOS"><a href="#Using-TensorFlow-On-IOS" class="headerlink" title="Using TensorFlow On IOS"></a>Using TensorFlow On IOS</h2><p>Welcome to KingSoft AILab! In this article, we’ll walk through getting TensorFlow, Google’s machine learning library, set up to perform inference directly on an iOS device.</p><h4 id="Installing-TensorFlow-on-IOS"><a href="#Installing-TensorFlow-on-IOS" class="headerlink" title="Installing TensorFlow on IOS"></a>Installing TensorFlow on IOS</h4><p>The binary distribution of TensorFlow for macOS does not include the IOS static library or some of the scripts we’ll need, so we’ll have to build both ourselves in a later section. Since it helps if the version of the iOS library is the same as the version of TensorFlow installed on our system, we’ll re-install the latest version of TensorFlow from source (even if it’s already installed). This can save us some headaches down the road.</p><p>DownLoad TensorFlow here: <a href="https://github.com/tensorflow/tensorflow">TensorFlow</a></p><p>If you have installed <a href="https://git-scm.com" target="_blank" rel="noopener">Git</a>,you can simply run:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/tensorflow/tensorflow.git</span><br></pre></td></tr></table></figure><p></p><h4 id="Building-Tensorflow-on-IOS"><a href="#Building-Tensorflow-on-IOS" class="headerlink" title="Building Tensorflow on IOS"></a>Building Tensorflow on IOS</h4><p>Note that tensorflow is built using a tool called bazel, and bazel requires some packages. if you have not installed, there is a easy way using Homebrew:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ brew install bazel</span><br><span class="line">$ brew install automake</span><br><span class="line">$ brew install libtool</span><br><span class="line">$ brew install autoconf</span><br></pre></td></tr></table></figure><p></p><p>From our directory of TensorFlow 1.3 sources, we can simply run:<br>Make sure that your tensorflow version is 1.3 , we can simply run the following command in your terminal in tensorflow’s directory:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -a</span><br></pre></td></tr></table></figure><p></p><p>Ckeckout your tensorflow version, simply run the command as follow, for example:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout r1.3</span><br></pre></td></tr></table></figure><p></p><p>Before building tensorflow on IOS，you will need to download all dependencies as well. It provided a script that does so, to be run (as with all commands) <strong>at the root of your tensorflow</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tensorflow/contrib/makefile/download_dependencies.sh</span><br></pre></td></tr></table></figure><p>For more information you can click here <a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile">Readme</a></p><p>To get the libraries compiled, you must install xcode(version &gt;7.3), you can install xcode from App Store.</p><p>Now, if you are buiding tensorflow r1.3 or lower, you can skip the following step. Otherwise, if you are compiling tensorflow r1.4 or r1.5, you should modify the <strong>tf_op_files.txt</strong> file in your <strong>tensorflow/contrib/makefile</strong> directory by adding</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tensorflow/core/ops/bitwise_ops.cc</span><br><span class="line">tensorflow/core/ops/audio_ops.cc</span><br><span class="line">tensorflow/core/ops/lookup_ops.cc</span><br></pre></td></tr></table></figure><p>to the file.</p><p>Then, you can run this from the root of your TensorFlow source folder:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tensorflow/contrib/makefile/build_all_ios.sh</span><br></pre></td></tr></table></figure><p>Running build_all_ios.sh will generate a TensorFlow static library in the tensorflow/contrib/makefile/gen/lib subdirectory. This library is compiled for ARMv7, ARM64, and x86 architectures, so you can use it in both the iOS simulator and on iOS hardware.</p><h4 id="Setting-up-xcode-project"><a href="#Setting-up-xcode-project" class="headerlink" title="Setting up xcode project"></a>Setting up xcode project</h4><p>Create a new xcode test project. then, we have to tell the iOS target about the TensorFlow static library we built for IOS (and the protocol buffer library is relies on). To do this, copy the following static library to your xcode test project. We can run the command to copy:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cp YOUR_TENSORFLOW_SOURCE_DIR/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a YOUR_XCODE_PROJECT_DIR/</span><br><span class="line">$ cp YOUR_TENSORFLOW_SOURCE_DIR/tensorflow/tensorflow/contrib/makefile/gen/protobuf_ios/lib/libprotobuf-lite.a YOUR_XCODE_PROJECT_DIR/</span><br><span class="line">$ cp YOUR_TENSORFLOW_SOURCE_DIR/tensorflow/tensorflow/contrib/makefile/gen/protobuf_ios/lib/libprotobuf.a YOUR_XCODE_PROJECT_DIR/</span><br></pre></td></tr></table></figure><p>After that, we should add the tensorflow static library to xcode project. Open your xcode project you have created, right-click the project name, select &gt;”Add Files to YOUR_PROJECT_NAME”, you will see <strong>libtensorflow-core.a</strong>, <strong>libprobuf-lite.a</strong>, <strong>libprotobuf.a</strong> in your pages, then add them. You can checkout whether or not you have add the static library sucessfully by selecting xcode menu: ‘Building Phases -&gt; Link Binary with Libraries’. Finally, add the <strong>Accelerate.framework</strong> library to ensure your tensorflow-program running fine.</p><p>Then add select xcode “Building Setting” menu, add <strong>$(PROJECT_DIR)/YOUR_PROJECT_NAME</strong> to Library Search Paths. Here replace <em>YOUR_PROJECT_NAME</em> to your project name. By the way, <strong>-force_load</strong> was used to decorate tensorflow.<br>Next, we’ll also add the following flags to Other Linker Flags:</p><p><strong>-force_load</strong><br><strong>$(PROJECT_DIR)/YOUR_PROJECT_NAME/libtensorflow-core.a</strong></p><p>Next, we add the following to Header Search Paths.</p><p><strong>YOUR_TENSORFLOW_SOURCE_FOLDER</strong><br><strong>YOUR_TENSORFLOW_SOURCE_FOLDER/tensorflow/contrib/makefile/gen/proto</strong><br><strong>YOUR_TENSORFLOW_SOURCE_FOLDER/tensorflow/contrib/makefile/downloads</strong><br><strong>YOUR_TENSORFLOW_SOURCE_FOLDER/tensorflow/contrib/makefile/downloads/protobuf/src</strong><br><strong>YOUR_TENSORFLOW_SOURCE_FOLDER/tensorflow/contrib/makefile/downloads/eigen</strong></p><p>Now that the xcode project is set up, you can load up your model and perform inference on the test datesets.</p><div class="post-announce">Thank you for reading, this article belongs to <a href="https://github.com/fatherai">Father AI</a> copyright</div><div class="post__prevs"><div class="post__prev"><a href="/2018/01/22/Handbook-of-Kingsoft-Automatic-Publisher/" title="Handbook of Kingsoft Automatic Publisher"><i class="iconfont icon-prev"></i>Handbook of Kingsoft Automatic Publisher</a></div><div class="post__prev post__prev--right"><a href="/2018/02/01/Graph_Transform_Tool/" title="Graph Transform Tool Experiment">Graph Transform Tool Experiment<i class="iconfont icon-next"></i></a></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">Introduction</h3><p class="block__text">Dedicated to sharing the latest achievements and experience in artificial intelligence</p></div><div class="sidebar__block"><h3 class="block__title">Categories</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/others/">others</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/machine-learning/">machine learning</a><span class="block-list-count">2</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/machine-learning/tensorflow/">tensorflow</a><span class="block-list-count">2</span></li></ul></li></ul></div><div class="sidebar__block"><h3 class="block__title">Latest Post</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2018/08/03/Fatherai-Service-Introduction/"><div class="item__cover"><img src="https://www.seoclerk.com/pics/550925-1fY25w1502215384.jpg" alt=""></div><div class="item__info"><h3 class="item__title"></h3><span class="item__text">2018-08-03</span></div></a></li><li class="latest-post-item"><a href="/2018/02/01/Graph_Transform_Tool/" title="Graph Transform Tool Experiment"><div class="item__cover"><img src="https://www.seoclerk.com/pics/550925-1fY25w1502215384.jpg" alt="Graph Transform Tool Experiment"></div><div class="item__info"><h3 class="item__title">Graph Transform Tool Experiment</h3><span class="item__text">2018-02-01</span></div></a></li><li class="latest-post-item"><a href="/2018/01/26/Using-tensorflow-On-IOS/" title="Using TensorFlow On IOS"><div class="item__cover"><img src="https://www.seoclerk.com/pics/550925-1fY25w1502215384.jpg" alt="Using TensorFlow On IOS"></div><div class="item__info"><h3 class="item__title">Using TensorFlow On IOS</h3><span class="item__text">2018-01-26</span></div></a></li><li class="latest-post-item"><a href="/2018/01/22/Handbook-of-Kingsoft-Automatic-Publisher/" title="Handbook of Kingsoft Automatic Publisher"><div class="item__cover"><img src="/2018/01/22/Handbook-of-Kingsoft-Automatic-Publisher/icon-handbook.jpeg" alt="Handbook of Kingsoft Automatic Publisher"></div><div class="item__info"><h3 class="item__title">Handbook of Kingsoft Automatic Publisher</h3><span class="item__text">2018-01-22</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">Tags</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/ios/">ios</a></li><li class="tag-item"><a class="tag-link" href="/tags/machine-learning/">machine learning</a></li><li class="tag-item"><a class="tag-link" href="/tags/others/">others</a></li><li class="tag-item"><a class="tag-link" href="/tags/tensorflow/">tensorflow</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">About</h3><div class="item__content"><p class="item__text">Dedicated to sharing the latest achievements and experience in artificial intelligence</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Shang Di, Beijing Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>guyi@kingsoft.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="http://oo12ugek5.bkt.clouddn.com/images/qrcode.png" alt="logo" title="Father AI"></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© 2017 powered by <a href="http://hexo.io/" target="_blank">Kingsoft</a>, made by Yi Gu.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/kingsoft-ai" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:guyi@kingsoft.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>