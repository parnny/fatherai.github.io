<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Graph Transform Tool Experiment | Father AI Blog</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="Yi Gu"><meta name="designer" content="minfive"><meta name="keywords" content="AI, deeplearning, RL, dnn"><meta name="description" content="Dedicated to sharing the latest achievements and experience in artificial intelligence"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://github.com/fatherai/2018/02/01/Graph_Transform_Tool/index.html"><link rel="icon" type="image/png" href="http://oo12ugek5.bkt.clouddn.com/blog/images/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Father AI"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(http://oo12ugek5.bkt.clouddn.com/blog/images/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Father AI" alt="Father AI"><img src="/img/kingsoft_logo.png" alt="Father AI"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="Home" title="Home">Home</a></li><li class="nav__item"><a href="/archives" alt="Archive" title="Archive">Archive</a></li><li class="nav__item"><a href="/about" alt="About" title="About">About</a></li><li class="nav__item"><a href="https://github.com/fatherai" alt="Github" title="Github"><i class="iconfont icon-github" style="font-size:32px"></i></a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="https://www.seoclerk.com/pics/550925-1fY25w1502215384.jpg" alt="Graph Transform Tool Experiment"></div><header class="post__info"><h1 class="post__title">Graph Transform Tool Experiment</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://github.com/C-ID">Tongyao Bai</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-02-01</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/tensorflow/">Tensorflow</a></li><li class="mark__item"><a href="/tags/machine-learning/">Machine Learning</a></li><li class="mark__item"><a href="/tags/ios/">Ios</a></li></ul></div></div></header><div class="post__content"><h2 id="Graph-Transform-Tool-Experiment"><a href="#Graph-Transform-Tool-Experiment" class="headerlink" title="Graph Transform Tool Experiment"></a>Graph Transform Tool Experiment</h2><p>Recently, we’ve done an experiment about how to using graph transform tool on frozen tensorflow-model. Looking back to the past time, lots of complicated errors have occurred during our test time.Fortunately, we managed to solve them at the end. So we wish our experience may help you.</p><p>If you have any question about how to using tensorflow on IOS, you can click here <a href="https://kingsoft-ai.github.io/2018/01/26/Using-tensorflow-On-IOS/" target="_blank" rel="noopener">Using-TensorFlow-On-IOS</a>. By the way, you could grasp everything about <strong>Graph Transform tool</strong> here <a href="https://github.com/tensorflow/tensorflow/tree/r1.3/tensorflow/tools/graph_transforms#quantize_nodes">Git</a></p><h4 id="Compared-tensorflow-r1-4-with-tensorflow-r1-5-version"><a href="#Compared-tensorflow-r1-4-with-tensorflow-r1-5-version" class="headerlink" title="Compared tensorflow-r1.4 with tensorflow-r1.5 version"></a>Compared tensorflow-r1.4 with tensorflow-r1.5 version</h4><p>At the very beginning, we consider whether or not the tensorflow version were affecting the speed of transformed models on ios. Aiming at verifying this improbability，we build this two versions on our Mac-mini.<br>Then, we took a series of experiments. <strong>Note that when you build your own deep-learning project on ios, you must ensure that your python-environment tensorflow version is the same as your built-on ios tensorflow version</strong>.</p><h4 id="Experiment-results"><a href="#Experiment-results" class="headerlink" title="Experiment results"></a>Experiment results</h4><p>After browsing all the transform references, we have selected some important parameters for testing. Since we need to enhance the cpu processing speed on portable devices, the step of optimizing is indispensable. According to the official document, <strong>This recipe removes all of the nodes that aren’t called during inference, shrinks expressions that are always constant into single nodes, and optimizes away some multiply operations used during batch normalization by pre-multiplying the weights for convolutions</strong>. When added these parameters for optimizing, your mobile cpu can run as fast as possible. At last, the official document introduces some parameters for shrinking the model size. Concretely, after our test, the model size can compressed to almost 70% smaller than the original model.</p><p>Bachmarks are as follow:</p><table><thead><tr><th style="text-align:center">parameters</th><th style="text-align:center">test1</th><th style="text-align:center">test2</th><th style="text-align:center">test3</th></tr></thead><tbody><tr><td style="text-align:center">frozen</td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td></tr><tr><td style="text-align:center">add_default_attributes</td><td style="text-align:center"></td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td></tr><tr><td style="text-align:center">fold_batch_norms</td><td style="text-align:center"></td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td></tr><tr><td style="text-align:center">fold_constants</td><td style="text-align:center"></td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td></tr><tr><td style="text-align:center">fold_old_batch_norms</td><td style="text-align:center"></td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td></tr><tr><td style="text-align:center">quantize_weights</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">Yes</td></tr><tr><td style="text-align:center">strip_unused_nodes</td><td style="text-align:center"></td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td></tr><tr><td style="text-align:center">remove_nodes</td><td style="text-align:center"></td><td style="text-align:center">Yes</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">tensorflow-r1.4(fps)</td><td style="text-align:center">9</td><td style="text-align:center">11</td><td style="text-align:center">11</td></tr><tr><td style="text-align:center">tensorflow-r1.5(fps)</td><td style="text-align:center">9</td><td style="text-align:center">10~11</td><td style="text-align:center">10~11</td></tr></tbody></table><div class="post-announce">Thank you for reading, this article belongs to <a href="https://github.com/fatherai">Father AI</a> copyright</div><div class="post__prevs"><div class="post__prev"><a href="/2018/01/26/Using-tensorflow-On-IOS/" title="Using TensorFlow On IOS"><i class="iconfont icon-prev"></i>Using TensorFlow On IOS</a></div><div class="post__prev post__prev--right"></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">Introduction</h3><p class="block__text">Dedicated to sharing the latest achievements and experience in artificial intelligence</p></div><div class="sidebar__block"><h3 class="block__title">Categories</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/others/">others</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/machine-learning/">machine learning</a><span class="block-list-count">2</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/machine-learning/tensorflow/">tensorflow</a><span class="block-list-count">2</span></li></ul></li></ul></div><div class="sidebar__block"><h3 class="block__title">Latest Post</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2018/02/01/Graph_Transform_Tool/" title="Graph Transform Tool Experiment"><div class="item__cover"><img src="https://www.seoclerk.com/pics/550925-1fY25w1502215384.jpg" alt="Graph Transform Tool Experiment"></div><div class="item__info"><h3 class="item__title">Graph Transform Tool Experiment</h3><span class="item__text">2018-02-01</span></div></a></li><li class="latest-post-item"><a href="/2018/01/26/Using-tensorflow-On-IOS/" title="Using TensorFlow On IOS"><div class="item__cover"><img src="https://www.seoclerk.com/pics/550925-1fY25w1502215384.jpg" alt="Using TensorFlow On IOS"></div><div class="item__info"><h3 class="item__title">Using TensorFlow On IOS</h3><span class="item__text">2018-01-26</span></div></a></li><li class="latest-post-item"><a href="/2018/01/22/Handbook-of-Kingsoft-Automatic-Publisher/" title="Handbook of Kingsoft Automatic Publisher"><div class="item__cover"><img src="/2018/01/22/Handbook-of-Kingsoft-Automatic-Publisher/icon-handbook.jpeg" alt="Handbook of Kingsoft Automatic Publisher"></div><div class="item__info"><h3 class="item__title">Handbook of Kingsoft Automatic Publisher</h3><span class="item__text">2018-01-22</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">Tags</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/ios/">ios</a></li><li class="tag-item"><a class="tag-link" href="/tags/machine-learning/">machine learning</a></li><li class="tag-item"><a class="tag-link" href="/tags/others/">others</a></li><li class="tag-item"><a class="tag-link" href="/tags/tensorflow/">tensorflow</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">About</h3><div class="item__content"><p class="item__text">Dedicated to sharing the latest achievements and experience in artificial intelligence</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Shang Di, Beijing Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>guyi@kingsoft.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="http://oo12ugek5.bkt.clouddn.com/images/qrcode.png" alt="logo" title="Father AI"></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© 2017 powered by <a href="http://hexo.io/" target="_blank">Kingsoft</a>, made by Yi Gu.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/kingsoft-ai" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:guyi@kingsoft.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>